<div style="
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(180deg, #eef6f2 0%, #dfeee8 100%);
  min-height: 100vh;
  padding: 25px 25px;
  display: flex;
  flex-direction: column;
">
  <div style="
    display: flex;
    justify-content: space-between;
    align-items: flex-start;  
    flex-wrap: wrap;   
  ">
    
    {{#if previsao}}
    <div style="
      background:#fff;
      margin-top:20px;
      padding:16px 20px;
      border-radius:14px;
      box-shadow:0 3px 10px rgba(0,0,0,0.10);
      width:100%;
    ">
      <h3 style="
        color:#133E34; 
        margin-bottom:14px; 
        font-size:1.2rem; 
        font-weight:700;
      ">
        Previsão para os próximos dias
      </h3>

      <div style="
        display:flex; 
        gap:14px; 
        overflow-x:auto; 
        padding-bottom:8px;
      ">
        {{#each previsao}}
          <div style="
            min-width:140px;
            background:#f3faf6;
            border-radius:12px;
            padding:14px 10px;
            text-align:center;
            box-shadow:0 1px 4px rgba(0,0,0,0.08);
          ">
            <p style="font-size:0.9rem; font-weight:700; color:#1a4d42;">
              {{this.diaSemana}}
            </p>

            <p style="font-size:0.85rem; font-weight:600; color:#3a6f62; margin-top:-4px;">
              {{this.dataFormatada}}
            </p>

            <img src="{{this.icone}}" style="width:55px; margin:6px 0;">

            <p style="font-size:0.85rem; color:#0077b6; margin-top:4px;">
              ☔ {{this.porcent_chuva}}%
            </p>

            <p style="font-size:1.1rem; font-weight:700; color:#133E34;">
              {{this.temp}}°C
            </p>

            <p style="font-size:0.85rem; color:#4a4a4a; margin-top:4px;">
              {{this.descricao}}
            </p>
          </div>
        {{/each}}
      </div>
    </div>
    {{/if}}

    <div id="container">
      {{#if clima}}
        <div id="weather" class="show">
          <h2 id="title">
            {{clima.cidade}}, {{clima.estado}}
          </h2>

          <div id="temp">
            <img id="temp_img" src="{{clima.icone}}" alt="icone do clima">
            <div>
              <p id="temp_value">{{clima.temp}}°C</p>
              <p id="temp_description">{{clima.descricao}}</p>
            </div>
          </div>

          <div id="other_infos">
            <div class="info">
              <i id="temp_max_icon" class="fa-solid fa-temperature-high"></i>
              <div>
                <h2>Máx</h2>
                <p id="temp_max">{{clima.temp_max}}°C</p>
              </div>
            </div>

            <div class="info">
              <i id="temp_min_icon" class="fa-solid fa-temperature-low"></i>
              <div>
                <h2>Mín</h2>
                <p id="temp_min">{{clima.temp_min}}°C</p>
              </div>
            </div>

            <div class="info">
              <i id="humidity_icon" class="fa-solid fa-droplet"></i>
              <div>
                <h2>Umidade</h2>
                <p id="humidity">{{clima.umidade}}%</p>
              </div>
            </div>

            <div class="info">
              <i id="wind_icon" class="fa-solid fa-wind"></i>
              <div>
                <h2>Vento</h2>
                <p id="wind">{{clima.vento}} km/h</p>
              </div>
            </div>
          </div>
        </div>
      {{else}}
        <p>Não foi possível obter o clima atual.</p>
      {{/if}}
    </div>

    <div style="
      background: #ffffff;
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      width: 80%;
      margin-top: 16px;             
      margin-left: 0;    
      margin-right: auto;
    ">
      <div style="
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        margin-bottom: 12px;
      ">
        <h2 style="
          font-size: 1.1rem; 
          font-weight: 700; 
          color: #133E34;
          margin: 0;
          display: flex;
          align-items: center;
          gap: 6px;
        ">
          <i class="fa-solid fa-seedling" style="font-size: 1rem;"></i>
          Minhas Plantas
        </h2>

        <a href="/planta/listagem" style="
          color: #1a5748; 
          text-decoration: none; 
          font-weight: 600;
          font-size: 0.85rem;
        ">
          Ver todas →
        </a>
      </div>

      {{#if ultimasPlantas.length}}
        <div style="
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
          justify-content: space-between;
        ">
          {{#each ultimasPlantas}}
            <div style="
              flex: 1;
              min-width: 220px;
              background: #f9fdfb;
              border-radius: 10px;
              padding: 12px 14px;
              border: 1px solid #e0e0e0;
              box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            ">
              <h3 style="
                color: #133E34; 
                font-size: 1rem; 
                font-weight: 700; 
                margin-bottom: 6px;
              ">
                {{this.nome}}
              </h3>

              <p style="
                color: #4b4b4b; 
                font-size: 0.85rem;
                margin: 0 0 4px 0;
              ">
                <i class="fa-solid fa-list-check"></i>
                <strong>Rotina:</strong> {{this.rotina.nome}}
              </p>

              <p style="
                color: #4b4b4b; 
                font-size: 0.82rem;
                margin: 0;
              ">
                <i class="fa-solid fa-calendar-days"></i>
                <strong>Cadastro:</strong> {{dateFormat this.createdAt}}
              </p>
            </div>
          {{/each}}
        </div>
      {{else}}
        <p style="text-align: center; color: #666; margin-top: 10px; font-size: 0.85rem;">
          Nenhuma planta cadastrada ainda.
        </p>
      {{/if}}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  if (params.has('lat') && params.has('lon')) return;

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        window.location.href = `/?lat=${lat}&lon=${lon}`;
      },
      err => {
        console.warn('Não foi possível obter localização. Usando padrão Ji-Paraná.');
      }
    );
  } else {
    console.warn('Geolocalização não suportada pelo navegador.');
  }
});
</script>
