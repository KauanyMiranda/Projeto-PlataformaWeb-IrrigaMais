<div class="container mt-5">
  <h2 class="mb-4">{{#if planta.id}}Editar Planta{{else}}Cadastro de Planta{{/if}}</h2>

  {{#if error}}
    <div class="alert alert-danger">{{error}}</div>
  {{/if}}

  <form method="post" action="{{#if planta.id}}/planta/editar/{{planta.id}}{{else}}/planta/novo/salvar{{/if}}">
    <div class="mb-3">
      <label for="nome" class="form-label">Nome da Planta</label>
      <input type="text" name="nome" id="nome" class="form-control" value="{{planta.nome}}" required>
    </div>

    <div class="mb-3">
      <label for="frequencia" class="form-label">Frequência</label>
      <select name="frequencia" id="frequencia" class="form-select" required>
        <option value="">Selecione</option>
        {{#each frequencias}}
          <option value="{{this}}" {{ifEquals this ../planta.frequencia}}>{{this}} vez(es)</option>
        {{/each}}
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Dias da irrigação:</label>
      {{#each diasSemana}}
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="dias" value="{{this}}" id="{{this}}" {{#if (includes this ../planta.dias)}}checked{{/if}}>
          <label class="form-check-label" for="{{this}}">{{this}}</label>
        </div>
      {{/each}}
    </div>

    <div class="mb-3">
      <label for="qtd_agua" class="form-label">Quantidade de Água (ml)</label>
      <input type="number" name="qtd_agua" id="qtd_agua" class="form-control" value="{{planta.qtd_agua}}" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Horários de Irrigação</label>
      <div id="horarios-container">
        {{#each (range 1 planta.frequencia)}}
          <div class="mb-2">
            <label class="form-label">Horário {{this}}</label>
            <input type="time" name="horarios[]" class="form-control" value="{{../planta.horarios.[@index]}}" required>
          </div>
        {{/each}}
      </div>
    </div>

    <div class="mb-3">
      <label for="sensor" class="form-label">Sensor</label>
      <select name="sensor" id="sensor" class="form-select" required>
        <option value="">Selecione</option>
        <option value="umidade" {{ifEquals "umidade" planta.sensor}}>Umidade</option>
        <option value="chuva" {{ifEquals "chuva" planta.sensor}}>Chuva</option>
      </select>
    </div>

    <button type="submit" class="btn btn-primary">{{#if planta.id}}Atualizar{{else}}Cadastrar{{/if}}</button>
  </form>
</div>

<script>
  const frequencia = document.getElementById('frequencia');
  const container = document.getElementById('horarios-container');

  frequencia.addEventListener('change', () => {
    let n = parseInt(frequencia.value) || 0;
    if(n > 4) n = 4;
    container.innerHTML = '';

    for (let i = 1; i <= n; i++) {
      const div = document.createElement('div');
      div.classList.add('mb-2');
      div.innerHTML = `
        <label class="form-label">Horário ${i}</label>
        <input type="time" name="horarios[]" class="form-control" required>
      `;
      container.appendChild(div);
    }
  });
</script>
